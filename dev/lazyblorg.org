# Time-stamp: <2013-08-22 21:20:55 vk>
# -*- coding: utf-8 -*-
* header information                                               :noexport:
:PROPERTIES:
:CREATED:  [2013-01-08 Tue 14:24]
:END:

#+TITLE:     lazyblorg development informations and issue tracker
#+AUTHOR:    Karl Voit
#+EMAIL:     tools@Karl-Voit.at
#+DATE:
#+DESCRIPTION:
#+KEYWORDS:
#+LANGUAGE:  en
#+OPTIONS:   H:3 num:t toc:t \n:nil @:t ::t |:t ^:t -:t f:t *:t <:t
#+OPTIONS:   TeX:t LaTeX:t skip:nil d:nil todo:t pri:nil tags:not-in-toc
#+INFOJS_OPT: view:nil toc:nil ltoc:t mouse:underline buttons:0 path:http://orgmode.org/org-info.js
#+EXPORT_SELECT_TAGS: export
#+EXPORT_EXCLUDE_TAGS: noexport
#+LINK_UP:
#+LINK_HOME:
#+XSLT:

#+STARTUP: hidestars

#+STARTUP: overview   (or: showall, content, showeverything)
http://orgmode.org/org.html#Visibility-cycling

#+TODO: TODO(t) NEXT(n) STARTED(s) WAITING(w@/!) SOMEDAY(S!) | DONE(d!/!) CANCELLED(c@/!)
http://orgmode.org/org.html#Per_002dfile-keywords

#+TAGS: { wish(w) bug(b) userstory(u) inconsistency(i) question(q) architecture(a) tests(t) }
http://orgmode.org/org.html#Setting-tags


* Issue Tracking                                                     :issues:
:PROPERTIES:
:VISIBILITY: children
:CREATED:  [2013-01-08 Tue 14:26]
:END:

NOTE: Some issues that are marked as DONE or CANCELED are moved to the
corresponding archive-file "lazyblorg.org_archive".

** DONE setting up test entry and resulting data                     :tests:
CLOSED: [2013-02-12 Tue 14:13] SCHEDULED: <2013-02-12 Tue>
:LOGBOOK:
- State "DONE"       from "NEXT"       [2013-02-12 Tue 14:13]
:END:
:PROPERTIES:
:CREATED: [2012-04-17 Tue 14:08]
:END:

- my local copy:
  - file:///home/vk/src/lazyblorg/testdata/full_test/blog/2013/02/12/lazyblorg-example-entry/index.html
- http://www.w3schools.com/tags/default.asp

- [X] Org-mode example files
  - containing non blogging content *and* headings marked with ":blog:" tag
  - containing the string ":blog:" as non-tag
  - containing org-mode blog entries in different hierarchy depth
- [X] containing elements:
  - headings 1-3
  - paragraphs
  - external links (URLs)
  - itemize-list
  - verse-block
  - no images yet
- [X] corresponding resulting HTML(5) files
  - meaning of HTML5 elements: [[http://stackoverflow.com/questions/4781077/html5-best-practices-section-header-aside-article-tags/6527766#6527766][short overview on stackoverflow]]
    - small: small print for legalese, or terms and conditions
    - em: emphasizing
    - header: on top of document or "section"; defined by its content
      (not position)
    - footer: at bottom of document or "section"; contains
      information about containing elements
    - aside: side bar; defined by content, not position; for related
      information; e.g., pullquotes
    - nav: major navigation information
    - article: content that would probably go together for RSS feed
    - section: content that is grouped; consider "header", "footer",
      "nav", "sidebar", "article" as special kind of sections
    - hgroup: grouping headings (for overview/index)
    - date/time:
      - <time datetime="17:00">5pm</time>
      - <time datetime="2010-04-07">April 7th</time>
      - <time datetime="2010-04-07T17:00">5pm on April 7th</time>
      - <time>5pm on April 7th</time>
      - "pubdate" attribute has been removed from the standard and is
        considered invalid on http://html5.validator.nu/
- no CSS yet

** DONE [#A] define (link) structure of blog entries                 :tests:
CLOSED: [2013-02-12 Tue 14:11]
:LOGBOOK:
- State "DONE"       from "NEXT"       [2013-02-12 Tue 14:11]
:END:
:PROPERTIES:
:CREATED: [2012-07-22 Sun 17:29]
:END:

- http://karl-voit.at/2012/07/22/example-entry/
with:
- "2012", "07", "22" being index pages (archive) containing links to all
  underlying blog entries
- "example-entry" is grabbed out of :ID: property
  - if :ID: is like "2012-07-22-example-entry" the date will be
    removed
  - if :ID: does not start with "YYYY-MM(-DD)" it gets used right away
  - user has to make sure that IDs are unique over all entries!

- http://karl-voit.at/blog/2012/11/31/This_is_the_title/index.html -> URL of
  entry; title gets parsed from heading title or ID
- http://karl-voit.at/blog/2012/11/31/ -> link to monthly overview (currently)
- http://karl-voit.at/blog/2012/11/ -> overview over the month
- http://karl-voit.at/blog/2012/ -> overview over the year
- http://karl-voit.at/blog/ -> blog starting page

- example: http://www.tbray.org/ongoing/misc/Colophon

** DONE sketch article layout                                    :userstory:
CLOSED: [2013-02-14 Thu 16:44]
:LOGBOOK:
- State "DONE"       from "NEXT"       [2013-02-14 Thu 16:44]
:END:
:PROPERTIES:
:CREATED:  [2013-02-14 Thu 16:39]
:END:

#+BEGIN_VERSE

MyBlog > 2013 > 02 > 14                               Published: 2013-02-14 T 16:40

               This is my Title About Something                Tag1 Foo Bar lang:en

    <article body text>




About this Blog                                                      check HTML/CSS
#+END_VERSE

- Breadcrumbs: gray
- Published...: gray
- Title(s): dark turquoise
- Tags: gray
- body: black
- About this: gray, small
- check ...: gray, small
- background: bright yellowish with possible gradient from dark (top)
  to bright (bottom)

** DONE sketch ArticleOrgEntry                                :architecture:
CLOSED: [2013-02-15 Fri 20:00]
:LOGBOOK:
- State "DONE"       from "NEXT"       [2013-02-15 Fri 20:00]
:END:
:PROPERTIES:
:CREATED:  [2013-02-15 Fri 19:58]
:END:

- holds current articles parsed from Org-mode files

- ArticleOrgEntry
  - NodeList
    - first entry contains main heading
    - other entries are at least one level deeper
  - TagList
  - Title
  - ID
  - TimeCreated
  - Checksum

** DONE sketch ArticleDBEntry                                 :architecture:
CLOSED: [2013-02-15 Fri 20:00]
:LOGBOOK:
- State "DONE"       from "NEXT"       [2013-02-15 Fri 20:00]
:END:
:PROPERTIES:
:CREATED:  [2013-02-15 Fri 19:59]
:END:

- holds list of article metadata from previous run(s)

- ArticleOrgEntry
  - NodeList
    - first entry contains main heading
    - other entries are at least one level deeper
  - TagList
  - Title
  - ID
  - TimeCreated
  - Checksum

** DONE spike: time-ordered-index data structure              :architecture:
CLOSED: [2013-08-20 Tue 15:02]
:LOGBOOK:
- State "DONE"       from "STARTED"    [2013-08-20 Tue 15:02]
:END:
:PROPERTIES:
:CREATED:  [2013-08-20 Tue 14:57]
:END:

- problem:
  - keep a sorted list of elements like [ [<time-stamp>,<id>], [...] ]

- http://wiki.python.org/moin/HowTo/Sorting/
  - sorting by index or named attribute!

Sorting by age using tuples:
#+BEGIN_SRC python
>>> student_tuples = [
        ('john', 'A', 15),
        ('jane', 'B', 12),
        ('dave', 'B', 10),
]
>>> sorted(student_tuples, key=lambda student: student[2])   # sort by age
[('dave', 'B', 10), ('jane', 'B', 12), ('john', 'A', 15)]
#+END_SRC

Sorting by attribute of a class:
#+BEGIN_SRC python
>>> class Student:
        def __init__(self, name, grade, age):
                self.name = name
                self.grade = grade
                self.age = age
        def __repr__(self):
                return repr((self.name, self.grade, self.age))

>>> student_objects = [
        Student('john', 'A', 15),
        Student('jane', 'B', 12),
        Student('dave', 'B', 10),
]
>>> sorted(student_objects, key=lambda student: student.age)   # sort by age
[('dave', 'B', 10), ('jane', 'B', 12), ('john', 'A', 15)]
#+END_SRC

** DONE Decision algorithm for generating entries; storage data :architecture:
CLOSED: [2013-08-20 Tue 14:44]
:LOGBOOK:
- State "DONE"       from "TODO"       [2013-08-20 Tue 14:44]
:END:
:PROPERTIES:
:CREATED:  [2012-11-06 Tue]
:ID: 2012-11-06-ago-generating
:END:

| *case* | *ID*      | *created*    | *last_update*   | *checksum*   | *result*                     | *description*                    |
|--------+-----------+--------------+-----------------+--------------+------------------------------+----------------------------------|
|      1 | not found | DC           | DC              | DC           | WARNING                      | blog-entry without ID            |
|      2 | not known | DC           | DC              | DC           | generate; RSS                | 1st time generation              |
|      3 | known     | not found    | DC              | DC           | WARNING                      | blog-entry without CREATED       |
|      4 | known     | not matching | DC              | DC           | ERROR                        | CREATED should not change        |
|      5 | known     | matching     | same as CREATED | matching     |                              | not changed since 1st generation |
|      6 | known     | matching     | unchanged       | matching     |                              | not changed since last update    |
|      7 | known     | matching     | unchanged       | not matching | generate; noRSS; noIncrement | silent update                    |
|      8 | known     | matching     | changed         | not matching | generate; RSS; Increment     | normal Update                    |

- for each ORGMODE-file
  - for each entry tagged with BLOGTAG AND in DONE state
    - if no :ID: found
      - case1
      - warning
      - continue with next heading
    - if ID not known
      - case2
      - generate RSS
      - generate HTML
      - continue with next heading
    - if CREATED not found
      - case3
      - warning
      - continue with next heading
    - if CREATED not matching previous run
      - case4
      - error-msg
      - continue with next heading
    - elseif CREATED and CHECKSUM matches
      - case5 or case6
      - debug: entry has not changed
    - elseif CREATED matches and CHECKSUM not matching
      - if LASTUPDATE changed
        - case8
        - increment update-number
        - generate RSS
        - generate HTML
      - else (if LASTUPDATE unchanged)
        - case7
        - generate HTML

- "RSS" means:
  - update time-ordered-index

- persistence storage has to hold (at least):
  - per blog entry:
    - ID
    - CREATED time-stamp
    - LAST_UPDATE time-stamp
    - checksum
  - time-ordered-index (OR: re-generate out of blog data)
    - LAST_UPDATE
    - ID

*** DONE [#A] finalize lazyblorg-algorithm sketch
CLOSED: [2012-11-10 Sat 18:10] DEADLINE: <2012-11-10 Sat>
:LOGBOOK:
- State "DONE"       from "NEXT"       [2012-11-10 Sat 18:10]
:END:
:PROPERTIES:
:CREATED:  [2012-11-07 Wed 21:23]
:END:
** STARTED implement basic work-flow *stub*                    :architecture:
:PROPERTIES:
:CREATED:  [2013-02-12 Tue 10:37]
:END:

- *no working version, only work-flow stub*, which will be filled with
  the actual code later on

invoking source code:
#+BEGIN_VERSE
vk@gary ~/src/lazyblorg (git)-[master] % PYTHONPATH="~/src/lazyblorg:" ./lazyblorg.py testdata/manual_prototype/org/test.org --targetdir testdata/2del -v
DEBUG    2013-05-20 17:58:02,643 extracting list of Org-mode files ...
DEBUG    2013-05-20 17:58:02,643 len(args) [1]
DEBUG    2013-05-20 17:58:02,643 1 filenames found: [testdata/manual_prototype/org/test.org]
DEBUG    2013-05-20 17:58:02,643 iterate over files ...
DEBUG    2013-05-20 17:58:02,644 OrgParser: doing file "testdata/manual_prototype/org/test.org" ...
DEBUG    2013-05-20 17:58:02,644 OrgParser: finished on file "testdata/manual_prototype/org/test.org"
DEBUG    2013-05-20 17:58:02,644 successfully finished.
vk@gary ~/src/lazyblorg (git)-[master] %
#+END_VERSE

- [X] find all headings with state DONE and tag :blog:
  - optionally: add all other tags starting with "blog-" as blog tags

- [X] one entry starts at such a heading until EOF OR same or less level
  heading is found

- [X] create checksum (see id:2013-02-15-checksum)
  - data['title']
  - data['timestamp']
  - data['tags']
  - data['content']

- [ ] compare raw text and IDs with last run

  - known ID, raw text unchanged: ignore, no change

  - new ID
    - generate new blog entry
      - extract YYYY-MM-DD from LOGBOOK-drawer (first *->DONE transformation)
      - generate YYYY/MM/DD-folder structure in blog accordingly
      - generate sanitized blog title as file name

  - known ID, raw text differs
    - generate update of existing entry
      - add "(Update n)" (with n is the n-th update) to entry title
        - optionally: add this also to URL
          - disadvantage: broken old URLs
          - advantage: URL reflects update state
        - ALTERNATIVELY: add "(Update YYYY-MM-DD)" instead of number
          - numbers don't mean anything

- on any activity:
  - [ ] re-write RSS feed for last n entries
  - [ ] optionally: generate overview page for last n entries
  - [ ] optionally: generate calendar archive page(s)
  - [ ] optionally: generate tag overview page(s)

- [ ] on any error:
  - [ ] create an orgmode event from current time that appears on agenda
  - [ ] with daily repeat -> so it gets noticed on the following day(s) too
  - [ ] in the description of that entry:
    - BONUS: babel-sh-snippet with prepared command to re-try the run :-)
** NEXT create a new module lib/htmlizer.py                   :architecture:
:PROPERTIES:
:CREATED:  [2013-08-22 Thu 21:15]
:END:

- holds everything which is needed for generating HTML/CSS output files

** STARTED create unit test for comparing HTML/CSS output files       :tests:
:PROPERTIES:
:CREATED:  [2013-02-14 Thu 17:28]
:END:

- Python: comparing files/directories: http://docs.python.org/2/library/filecmp.html

- example: https://github.com/bjonnh/PyOrgMode/blob/master/test.py
  - comparing Org-mode files line-by-line

*** Idea: parse content test cases from Org file

A file like «tests.org» contains test cases, each one in a
heading. if it starts with «test: » it is a test case followed by its
test name.

A sub-heading «Org» contains the Org-mode document/snippet which gets
parsed.

A sub-heading «result» contains the results which is expected.
** TODO Idea: do paragraph parsing                            :architecture:
:PROPERTIES:
:CREATED:  [2013-02-27 Wed 16:48]
:END:

- paragraphs are separated by at least one empty line OR they end
  with a line starting with:
  - »#+«
- each paragraph is handled separately BUT paragraphs of an
  environment are being combined
- for each normal text paragraph:
  - remove \n
  - sanitize
    - insert lazyblorg-specific links
    - HTMLize with ...
      - either simple with own code OR
        - fast
        - only a few syntax elements can be parsed
      - using Org-mode exporter methods
        - slow
        - complicated set-up
        - supports everything which is supported by the Org-mode HTML
          export
    - if simple HTMLizer chosen:
      - re-insert \n for first space after 80 characters

Documentation:
- clearly state that lazyblorg does support *no org-mode syntax*
  except <list-of-supported-elements-and-their-context>
** NEXT CSS: manually create CSS for an entry                 :architecture:
:PROPERTIES:
:CREATED:  [2013-02-12 Tue 14:14]
:END:

** NEXT paper: sketch main page                                   :userstory:
:PROPERTIES:
:CREATED:  [2013-02-14 Thu 16:39]
:END:
** NEXT HTML: manually create main jumping page                :architecture:
:PROPERTIES:
:CREATED:  [2013-02-12 Tue 12:24]
:END:

- HTML5-example: see Kröner2011 p.123ff

** NEXT [#C] HTML: manually create month overview page        :architecture:
:PROPERTIES:
:CREATED:  [2013-02-12 Tue 14:12]
:END:

** NEXT [#C] HTML: manually create day overview page          :architecture:
:PROPERTIES:
:CREATED:  [2013-02-12 Tue 14:11]
:END:

** NEXT [#C] HTML: manually create year overview page         :architecture:
:PROPERTIES:
:CREATED:  [2013-02-12 Tue 14:12]
:END:

** TODO provide RSS feed(s)                                      :userstory:
:PROPERTIES:
:CREATED:  [2012-11-05 Mon 10:57]
:END:

- sorted by last date within LOGBOOK or PROPERTIES drawers
- one general RSS feed
- one feed for each tag

** TODO mark updates on entries                                :architecture:
:PROPERTIES:
:CREATED:  [2012-11-05 Mon 10:50]
:END:

- heading gets a blog entry with a unique :ID:
- setting "Update 1/2/3/..." for each one of those:
: :LOGBOOK:
: - State "DONE"       from "NEXT"       [2011-10-07 Fri 15:40]
: :END:
- ALTERNATIVELY: set "Update YYYY-MM-DD for last one of those (from above)
- heading with known unique ID and no state DONE
  - should stay the same until state changes back to DONE
  - this requires something which remembers states
  - this requires keeping old entries

- body:
  - manual section:
    - Updates:
      1. YYYY-MM-DD: short description
      2. YYYY-MM-DD: short description

see also id:2012-11-06-ago-generating
** TODO CSS: add slightly yellowish background                   :userstory:
:PROPERTIES:
:CREATED: [2012-05-11 Fri 09:36]
:END:

- if possible: very smooth color gradient from top to bottom

** TODO write colophon                                           :userstory:
:PROPERTIES:
:CREATED:  [2013-02-12 Tue 11:31]
:END:

- example: http://www.tbray.org/ongoing/misc/Colophon

- containing
  - basic tools used
  - basic workflow
  - ...

** TODO [#B] CSS generated using Org/babel                    :architecture:
:PROPERTIES:
:CREATED:  [2012-12-13 Thu 10:08]
:END:

- css.org with Comments and css-blocks

#+BEGIN_SRC css
example-CSS content
#+END_SRC

- automatically extracting CSS code from that Org-mode file

- example: http://www.tbray.org/ongoing/When/201x/2011/04/21/Reflowing

backward compatibility for old browsers:
#+BEGIN_SRC css
section, article, header, footer, nav, aside, hgroup {
display: block;
}
#+END_SRC
** TODO [#B] include image files                                 :userstory:
:PROPERTIES:
:CREATED:  [2012-11-05 Mon 10:54]
:END:

- "lbimg:image.png"
  - works in Orgmode using custom link to valid folder
  - lazyblorg recognizes it and translates it to img

- show a fixed maximum width/height image
  - probably with a magnifying glass and a plus symbol in its lower
    right corner
- show the big version when clicking on it

- see Kröner2011 p.140ff for HTML5 and figure/caption

*** TODO research different Org-mode ways of defining including images
:PROPERTIES:
:CREATED:  [2012-11-05 Mon 10:55]
:END:

1. just link a file, do not show image
2. show the linked image directly
** TODO [#B] format tables                                       :userstory:
:PROPERTIES:
:CREATED:  [2012-12-21 Fri 09:49]
:END:

- add JavaScript to be able to sort by column
- possible cnadidates for methods
  - http://tablesorter.com/docs/
  - HTML5 (?)
  - CSS: http://www.cssjuice.com/16-sortable-table-techniques/

- for lists
  - http://farhadi.ir/projects/html5sortable/

** TODO [#C] Date in heading = link to day in Wikipedia          :userstory:
:PROPERTIES:
:CREATED:  [2013-01-08 Tue 14:38]
:END:

- YYYY-MM-DD -> links to Wikipedia-entries of days
  - https://en.wikipedia.org/wiki/Portal:Current_events/2010_August_26

** TODO [#C] add frames to images                                :userstory:
:PROPERTIES:
:CREATED:  [2013-02-12 Tue 11:27]
:END:

- example: http://www.tbray.org/ongoing/When/200x/2006/04/08/Picture-Frames
  - caution: that's Java

** TODO [#C] tags, tag cloud, tag descriptions                   :userstory:
:PROPERTIES:
:CREATED:  [2012-11-05 Mon 10:57]
:END:

- tag cloud for getting a quick overview on the blog itself
- a list of all tags on front page with link to tag-descriptions
- each tag gets a tag-description page
  - what I mean by this tag with examples
  - link to RSS feed for this tag
  - link to a list of blog entries for this tag

- see also id:2012-11-11-autotags

** TODO [#C] auto-tag entries                                    :userstory:
:PROPERTIES:
:CREATED:  [2012-11-11 Sun 13:43]
:ID: 2012-11-11-autotags
:END:

- auto-tags are visually separated from manual tags to make it clear
  that they are automatically generated (and might be bogus sometime)

*** Language
:PROPERTIES:
:CREATED:  [2012-11-11 Sun 13:44]
:END:

- lang-de, de, en, us, ... ?
- language tag is automatically derived
  - by guessing language based on common stopwords or external library

*** Length
:PROPERTIES:
:CREATED:  [2012-11-11 Sun 13:44]
:END:

- oneliners
  - below a certain threshold
- middlesize(sic?)
  - between oneliners and fullsizeentries
- fullsize(sic?)

*** Auto-Disclaimer
:PROPERTIES:
:CREATED:  [2012-11-15 Thu 11:47]
:END:

- hooks for :TAGS: (can be optional) or case-sensitive keywords in headings
- if found:
  - link to a special pre-defined page

- Example: if "What The World Needs"|"WTWN:" is found, link to a page
  where WTWN-series is described in general.
** TODO [#C] Inline HTML                                         :userstory:
:PROPERTIES:
:CREATED:  [2013-02-12 Tue 10:32]
:END:

- writing HTML tags directly (not within any SRC-blocks)
- makes it easier to port old blog content

** TODO [#C] internal links to other blog entries                :userstory:
:PROPERTIES:
:CREATED:  [2013-02-12 Tue 10:34]
:END:

** TODO [#C] content of help pages from Org heading              :userstory:
:PROPERTIES:
:CREATED:  [2013-02-27 Wed 16:37]
:END:

Somewhere in my Org files, I do have a heading «$BLOGNAME». Within
its sub-heading «Help» there is the text for the main help
page. Further headings contain more content for other pages.

** SOMEDAY add/create/include/handle short URLs for each entry   :userstory:
:LOGBOOK:
- State "SOMEDAY"    from ""           [2013-08-20 Tue 10:56]
:END:
:PROPERTIES:
:CREATED:  [2013-08-20 Tue 10:56]
:END:

- e.g.:
  - www.example.com/blog/i/aB3 ->
  - www.example.com/i/aB3 ->
- generate short URL as hash from ID?
  - is it possible without getting a high chance of conflicts?

** SOMEDAY blog comments                                          :userstory:
:LOGBOOK:
- State "SOMEDAY"    from ""           [2013-02-12 Tue 10:35]
:END:
:PROPERTIES:
:CREATED:  [2013-02-12 Tue 10:35]
:END:

- simplest form: generate unique Email link and add at bottom
  - very easy to be done for catch-all MTAs
  - automatically derive whitelist for MTA to avoid old spam
- simple HTML form
  - POST to script, adding comment to my inbox.org (containing
    link to ID)
- disqus: I do not want to outsource comment hosting :-(

** SOMEDAY handle :noexport: tag                                 :userstory:
:LOGBOOK:
- State "SOMEDAY"    from ""           [2013-08-22 Thu 11:45]
:END:
:PROPERTIES:
:CREATED:  [2013-08-22 Thu 11:45]
:END:

- see http://orgmode.org/manual/Selective-export.html

** SOMEDAY guessing language of entry                            :userstory:
:LOGBOOK:
- State "SOMEDAY"    from ""           [2013-01-08 Tue 14:36]
:END:
:PROPERTIES:
:CREATED:  [2012-11-11 Sun 10:53]
:END:

- https://github.com/dsc/guess-language

** SOMEDAY hidden entries by using tag "notlinked"               :userstory:
:LOGBOOK:
- State "SOMEDAY"    from ""           [2013-01-08 Tue 14:46]
:END:
:PROPERTIES:
:CREATED:  [2012-12-14 Fri 22:51]
:END:

- if web server does not allow directory listing, this entry can only
  be found with knowledge of the URL
- check: is Google crawler able to find it when it's not linked?

** SOMEDAY fixed entries by using a tag                          :userstory:
:LOGBOOK:
- State "SOMEDAY"    from ""           [2013-01-08 Tue 14:46]
:END:
:PROPERTIES:
:CREATED:  [2012-12-21 Fri 09:48]
:END:

- outside of YYYY/MM/DD-hierarchy
- e.g.
  - tools I use
  - books I read
  - ...
** SOMEDAY publish (only) free/busy times (in multiple formats)  :userstory:
:LOGBOOK:
- State "SOMEDAY"    from ""           [2013-01-08 Tue 14:48]
:END:
:PROPERTIES:
:CREATED:  [2012-12-29 Sat 17:40]
:END:

** SOMEDAY CSS: round corners of images                          :userstory:
:LOGBOOK:
- State "SOMEDAY"    from "NEXT"       [2013-01-08 Tue 14:53]
:END:
:PROPERTIES:
:CREATED:  [2013-01-07 Mon 18:40]
:END:

- probably steal from http://www.tbray.org/ongoing/

** SOMEDAY [[http://tasker.dinglisch.net/][Tasker]]-script: share URL and send to my lazyblorg     :userstory:
:LOGBOOK:
- State "SOMEDAY"    from ""           [2013-07-20 Sat 10:58]
:END:
:PROPERTIES:
:CREATED:  [2013-08-22 Thu 21:19]
:END:

- open questions
  - encryption
    - necessary? in the end, it gets public anyway :-)
  - prevent "content injection"
    - PKI: signing with private GnuPG-key of phone device?
      - DoS-attack still possible
        - sending a lot of fake messages
    - synchronous password?
    - ?
** SOMEDAY re-generate only necessary entries/pages            :architecture:
:LOGBOOK:
- State "SOMEDAY"    from ""           [2013-08-22 Thu 21:19]
:END:
:PROPERTIES:
:CREATED:  [2013-08-22 Thu 21:19]
:END:

switch from "delete everything and re-generate everything on every
run" to "delete and re-generate only necessary entries/pages"

** SOMEDAY [#C] in order not to parse *whole* content, split up parsing
:LOGBOOK:
- State "SOMEDAY"    from ""           [2013-08-21 Wed 11:58]
:END:
:PROPERTIES:
:CREATED:  [2013-08-21 Wed 11:58]
:END:

For optimizing performance and RAM usage: use *two parsing processes*:

  1. find new or updated articles
     - parse for used ID-links
     - collect and store metadata of these (everything except content)
     - print out warnings for all IDs that are broken links
     - create creative 404-page for all broken links in the meantime

  2. parse everything again and store only new or updated article contents
     - match with ID-links

* Notes                                                               :notes:

** Naming this project
:PROPERTIES:
:CREATED:  [2013-08-20 Tue 10:18]
:END:

lazyblorg - a mixture of lazy, blogging, blog, org-mode - emphasizes
the fact that the *user* of it may be very lazy. This relates to the
minimal effort she/he has to do in order to create a new blog entry.

There are no hits in [[https://www.google.com/#fp%3De12793cfcde69436&hl%3Den&nfpr%3D1&q%3Dlazyblorg&safe%3Doff][Google search for "lazyblorg"]]. However, there
are some for "lazyblog" (without the 'r').

- Other cool names would be:
  - invisiblorg
    - invisible, blog, org-mode
    - emphasizes the invisibility of the blog mechanism once it is
      set up
    - no hits for "[[https://www.google.com/#fp%3De12793cfcde69436&hl%3Den&nfpr%3D1&q%3Dinvisiblorg&safe%3Doff][invisiblorg]]" but some for "invisiblog" or "invisibl.org"

** Implemented Org-mode Elements
:PROPERTIES:
:ID: implemented-org-elements
:END:

- list of Org Mode elements: http://article.gmane.org/gmane.emacs.orgmode/67871
  - will get on Worg some day!

Org elements: from ox-ascii.el

#+NAME: implemented-org-elements
| *Org Element*       | earmarked | low prio | implemented since | internal representation                                                                | *HTML5*           |
|---------------------+-----------+----------+-------------------+----------------------------------------------------------------------------------------+-------------------|
| bold                |           |          |                   |                                                                                        | em                |
| center-block        |           | x        |                   |                                                                                        |                   |
| clock               |           | x        |                   |                                                                                        |                   |
| code                |           |          |                   |                                                                                        | code              |
| drawer              |           |          |                   |                                                                                        |                   |
| dynamic-block       |           | x        |                   |                                                                                        |                   |
| entity              |           |          |                   |                                                                                        |                   |
| example-block       |           |          |                   |                                                                                        |                   |
| export-block        |           | x        |                   |                                                                                        |                   |
| export-snippet      |           | x        |                   |                                                                                        |                   |
| fixed-width         |           | x        |                   |                                                                                        |                   |
| footnote-definition |           | x        |                   |                                                                                        |                   |
| footnote-reference  |           | x        |                   |                                                                                        |                   |
| headline            | x         |          |                   | ['heading', {'level': 3, 'title': u'my title'}]                                        | section+header+h1 |
| horizontal-rule     |           | x        |                   |                                                                                        |                   |
| inline-src-block    |           | x        |                   |                                                                                        |                   |
| inlinetask          |           | x        |                   |                                                                                        |                   |
| inner-template      |           | x        |                   |                                                                                        |                   |
| italic              |           | x        |                   |                                                                                        |                   |
| item                |           |          |                   |                                                                                        |                   |
| keyword             |           | x        |                   |                                                                                        |                   |
| latex-environment   |           | x        |                   |                                                                                        |                   |
| latex-fragment      |           | x        |                   |                                                                                        |                   |
| line-break          |           | x        |                   |                                                                                        |                   |
| link                | x         |          |                   |                                                                                        |                   |
| paragraph           | x         |          |                   | ['par', u'line1', u'line2']                                                            |                   |
| plain-list          | x         |          |                   | ['list-itemize', [u'first line', u'second line']]                                      | ul+li             |
| plain-text          | x         |          |                   | see: paragraph                                                                         |                   |
| planning            |           | x        |                   |                                                                                        |                   |
| quote-block         |           |          |                   |                                                                                        | blockquote        |
| quote-section       |           |          |                   |                                                                                        |                   |
| radio-target        |           | x        |                   |                                                                                        |                   |
| section             |           |          |                   |                                                                                        |                   |
| special-block       |           | x        |                   |                                                                                        |                   |
| src-block           |           |          |                   |                                                                                        |                   |
| statistics-cookie   |           | x        |                   |                                                                                        |                   |
| strike-through      |           | x        |                   |                                                                                        |                   |
| subscript           |           | x        |                   |                                                                                        |                   |
| superscript         |           | x        |                   |                                                                                        |                   |
| table               |           |          |                   |                                                                                        |                   |
| table-cell          |           |          |                   |                                                                                        |                   |
| table-row           |           |          |                   |                                                                                        |                   |
| target              |           |          |                   |                                                                                        |                   |
| template            |           | x        |                   |                                                                                        |                   |
| timestamp           |           | x        |                   |                                                                                        |                   |
| underline           |           | x        |                   |                                                                                        |                   |
| verbatim            |           |          |                   |                                                                                        | pre               |
| verse-block         |           |          |                   |                                                                                        | pre               |
| html-block          |           |          |                   | ['html-block', 'its name or None', [u'first line', u'second line', u'', u'last line']] |                   |

- Blocks: (beginning with ~BEGIN_~)
  - [[http://orgmode.org/org.html#index-g_t_0023_002bBEGIN_005fASCII-1620][ASCII]]
  - [[http://orgmode.org/org.html#index-g_t_0023_002bBEGIN_005fHTML-1661][HTML]]
  - [[http://orgmode.org/org.html#index-g_t_0023_002bBEGIN_005fLATEX-1719][LATEX]]
  - [[http://orgmode.org/org.html#index-g_t_0023_002bBEGIN_005fQUOTE-1493][QUOTE]]
  - [[http://orgmode.org/org.html#index-g_t_0023_002bBEGIN_005fSRC-1885][SRC]]
  - [[http://orgmode.org/org.html#index-g_t_0023_002bBEGIN_005fVERSE-1492][VERSE]]

** Representation of blog data
CLOSED: [2013-08-20 Tue 18:15]
:LOGBOOK:
- State "DONE"       from "STARTED"    [2013-08-20 Tue 18:15]
:END:
:PROPERTIES:
:CREATED:  [2013-05-21 Tue 15:26]
:ID: blog_data
:END:

For a complete list of *content elements*, please take a look at
id:implemented-org-elements (above)

~blog_data~ is a Python list containing one dictionary entry per blog
entry:

#+BEGIN_SRC python
  blog_data = \
  [ {'level': 2,                                                ## number of asterisks
     'title': u'This is a blog entry about foo', 
     'tags': [u'tag1', u'tag2'], 
     'id': u'lazyblorg-example-entry',                          ## ID from PROPERTIES-drawer
     'finished-timestamp-history': [datetime1, datetime2, datetime3],
     'timestamp': datetime,                                    ## most current time-stamp
     'created: datetime,
     'content': [ ['par', u'This is the Org-mode content'],    ## 'par: paragraph containing anything that is not defined like tables, ...
                  '\n',    ## change of paragraph
                  ['heading', {'level': 3, 'title': u'Another aspect'}],  
                  ['html-block', 'its name or None', [u'first line', u'second line', u'', u'last line']],
                  ['list-itemize', [u'first line', u'second line']],
                  ['table', u'followed by this table data'],         #FIXXME: table syntax
                  ['image', u'followed by this image']               #FIXXME: image syntax
                ]                                                    #FIXXME: further elements
  } ]
#+END_SRC

Thus:
#+BEGIN_SRC python
blog_data[0].keys()
## ... results in:
# ['title',
#  'timestamp',
#  'created',
#  'tags',
#  'content',
#  'finished-timestamp-history',
#  'level',
#  'id']

blog_data[0]['content']  ## -> list of elements of content
# [['text', u'This is the Org-mode content'],
#  ['heading', {'level': 3, 'title': u'Another aspect'}],
#  ['list-itemize', [u'first line', u'second line']],
#  ['table', u'followed by this table data'],
#  ['image', u'followed by this image']]
#+END_SRC
** Internal format of meta-data 
:PROPERTIES:
:CREATED:  [2013-08-22 Thu 21:08]
:END:

Example:
#+BEGIN_EXAMPLE
>>> metadata
{u'2013-08-22-testid': {'timestamp': datetime.datetime(2013, 8, 22, 21, 6), 'checksum': 'b757f8478bffd6c70a474f213d6520de', 'created': datetime.datetime(2013, 8, 22, 21, 6)}, 
 u'2013-02-12-lazyblorg-example-entry': {'timestamp': datetime.datetime(2013, 2, 14, 19, 2), 'checksum': '24af2246a5121e829a0dbbd6e2425c15', 'created': datetime.datetime(2013, 2, 12, 10, 58)}}
#+END_EXAMPLE

Keys of the dict: IDs of the entries:
#+BEGIN_EXAMPLE
>>> metadata.keys()
[u'2013-08-22-testid', u'2013-02-12-lazyblorg-example-entry']
#+END_EXAMPLE

One entry with key=ID holds a dict with following entries:
- 'timestamp': datetime.datetime(2013, 8, 22, 21, 6)
  - most recent time-stamp from the LOGBOOK drawer which marked going
    to a final state
- 'checksum': 'b757f8478bffd6c70a474f213d6520de'
  - md5 check-sum of: [title, tags, finished_timestamp_history, content]
- 'created': datetime.datetime(2013, 8, 22, 21, 6)
  - datetime object of the CREATED property from the PROPERTY drawer

** Development Schedule
:PROPERTIES:
:CREATED:  [2012-11-05 Mon 10:59]
:END:

this is the plan (from 2012-11):

- manually generate demo prototype
  - very basic Org-mode example file containing everything from below
  - HTML5 entry page
  - CSS2 style
  - HTML5 blog entry page
  - Tag description page
  - RSS feed
  - HTML5 blog entry page with update
  - Index overview page (archive)
  - description of basic work-flow for generating the blog
    - user point of view
    - system point of view
- refine and test design and features of prototype
  - ask for feedback
  - play around, break things
- development
  - define order of Org-mode items (headings, lists, images, ...) implementation priority
  - define even more basic (Org-mode, HTML) from above
  - very basic unit-tests from prototype files (Org-mode, HTML)
  - test and refine work-flow for (re-)generating the blog
  - implement more and more Org-mode items

** Wishlist without compromises
:PROPERTIES:
:ID: 2012blogwishlist-copy
:CREATED:  [2013-01-07 Mon 18:40]
:END:

NOTE: if entries are marked as done in this section, they are not
implemented but moved to a (separate) user-story above.

- Workflow to create a blog entry
  - make sure that there is an (uniq) :ID: property
  - add tag :blog: to heading
  - write content, subheadings, ...
  - change state of top-heading to DONE
  - (manually) invoke generation-script

- usage of only very basic markup
  - [X] paragraphs (p)
  - [X] headings (h1..n)
  - [X] http-references (a href)
  - [X] lists (ul)
  - [X] quote (verbatim)
  - [X] images (img)
  - [X] tables
  - [X] inline-HTML
  - [X] internal links to other entries

- advantages
  - a blog entry can be located anywhere in all of my Orgmode files
  - no extra formatting steps
  - very small overhead to create a blog entry
  - no duplicate information
    - update only in Orgmode, not HTML or any in-between format
  - static (fast) pages
  - self-hosting without any fancy services behind like RDBS

- open issues
  - [X] comments
    - simplest form: generate unique Email link and add at bottom
      - very easy to be done for catch-all MTAs
      - automatically derive whitelist for MTA to avoid old spam
    - simple HTML form
      - POST to script, adding comment to my inbox.org (containing
        link to ID)
    - disqus: I do not want to outsource comment hosting :-(
  - [X] how to include and format graphics?
    - sometimes, I e.g. want to have an image aligned right with text
      flowing around it
  - [-] probably: usage of in-between format like ikiwiki
    - Orgmode syntax -> ikiwiki markup (markdown?) -> usual
      ikiwiki-workflow
      - should be not much effort since prerequisites limit to few
        markup things
    - benefits from not having to re-implement many things
    - in-between-format HTML (like Manoj uses) is way too complicated
      causing misc potential error sources

- [ ] basic script workflow
  - find all headings with state DONE and tag :blog:
    - optionally: add all other tags starting with "blog-" as blog tags
  - one entry starts at such a heading until EOF OR same or less level
    heading is found
  - compare raw text and IDs with last run
    - known ID, raw text unchanged: ignore, no change
    - new ID
      - generate new blog entry
        - extract YYYY-MM-DD from LOGBOOK-drawer (first *->DONE transformation)
        - generate YYYY/MM/DD-folder structure in blog accordingly
        - generate sanitized blog title as file name
    - known ID, raw text differs
      - generate update of existing entry
        - add "(Update n)" (with n is the n-th update) to entry title
          - optionally: add this also to URL
            - disadvantage: broken old URLs
            - advantage: URL reflects update state
  - on any activity:
    - re-write RSS feed for last n entries
    - optionally: generate overview page for last n entries
    - optionally: generate calendar archive page(s)
    - optionally: generate tag overview page(s)
  - on any error:
    - create an orgmode event from current time that appears on agenda
    - with daily repeat -> so it gets noticed on the next day(s) too
    - in the description of that entry:
      - babel-sh-snippet with prepared command to re-try the run :-)

** Original post (How this all started)

Copied from: http://article.gmane.org/gmane.emacs.orgmode/49747/

Hi!

I got a nice idea on how a very easy to use Org-mode blog system
should look like.

Currently, I am using Serendipidy with web-based editor to write
HTML. Org-mode enabled me to write blog entries and export it to
HTML. Then I paste the HTML and have to modify minor things (images,
...) a bit. I guess the time from finishing the Org-mode entry to
the final blog entry is approximately ten to twenty minutes.

Overall, I do not want to do this process when I just want to
quickly write a view paragraphs within a couple of minutes. I need
a workflow with much less annoying overhead.

Therefore I sat down and thought about a workflow that should be
enough for writing simple weblog entries:

  - create an Org-mode heading (anywhere!)
  - make sure that there is an (uniq) :ID: property
  - add the tag :blog: to heading
  - <write content, subheadings, ...>
  - change state of top-heading to DONE
    - this enables blog entries «in the queue»
  - (manually) invoke generation-script

This enables me quick blogging with a list of advantages:

  - a blog entry can be located anywhere in all of my Orgmode files
  - no extra formatting steps
  - very small (almost non-existent) overhead to create a blog entry
  - no duplicate information
    - updates only in Orgmode, not HTML or any in-between format
  - static (fast) pages
  - self-hosting without any fancy services behind like RDBS

What do you think of my ideas so far?

Of course, I looked into existing solutions and found those:

  - http://orgmode.org/worg/org-blog-wiki.html
    - cool overview page for various solutions
  - http://orgmode.org/worg/blorgit.html
    - pretty complex set up :-(
    - I do not need a web-interface to edit Org-mode files
    - seem to have «different» use cases
  - http://orgmode.org/worg/org-tutorials/org-jekyll.html
    - uses HTML as in-between format; seems to provide many error
      possibilities(?)
    - converting whole files only (not desired)
    - have to try it someday
  - http://emacs-fu.blogspot.com/2009/05/writing-and-blogging-with-org-mode.html
    - uses only HTML export
  - http://blog.herraiz.org/archives/241
    - uses only HTML export
  - https://github.com/chrismgray/ikiwiki-org-plugin
    - promising but only one part of a possible solution

So nothing offers the features and small footprint as my idea above
:-(

With some prerequisites, it should not be that hard to even
implement it by myself:

  - usage of only very basic markup
    - paragraphs (p)
    - headings (h1..n)
    - http-references (a href)
    - lists (ul)
    - images (img)
    - quote (verbatim)

Still there are some open issues:

  - comments
    - simplest form: generate unique Email link and add at bottom
      - very easy to be done for catch-all MTAs
      - automatically derive whitelist for MTA to avoid old spam
    - simple HTML form
      - POST to script, adding comment to my inbox.org (containing
        link to ID)
    - disqus: I do not want to outsource comment hosting :-(
  - how to include and format graphics?
    - sometimes, I e.g. want to have an image aligned right with text
      flowing around it
  - probably: usage of in-between format like ikiwiki
    - Orgmode syntax -> ikiwiki markup (markdown?) -> usual
      ikiwiki-workflow
      - should be not much effort since prerequisites limit to few
        markup things
    - benefits from not having to re-implement many things
    - in-between-format HTML (like Manoj uses) is way too complicated
      causing misc potential error sources

The basic script workflow is not that complicated:

  - find all headings with state DONE and tag :blog:
    - optionally: add all other tags starting with "blog-" as blog tags
  - one entry starts at such a heading until EOF OR same or less level
    heading is found
  - compare raw text and IDs with last run
    - known ID, raw text unchanged: ignore, no change
    - new ID
      - generate new blog entry
        - extract YYYY-MM-DD from LOGBOOK-drawer (first *->DONE transformation)
        - generate YYYY/MM/DD-folder structure in blog accordingly
        - generate sanitized blog title as file name
    - known ID, raw text differs
      - generate update of existing entry
        - add "(Update n)" (with n is the n-th update) to entry title
          - optionally: add this also to URL
            - disadvantage: broken old URLs
            - advantage: URL reflects update state
  - on any activity:
    - re-write RSS feed for last n entries
    - optionally: generate overview page for last n entries
    - optionally: generate calendar archive page(s)
    - optionally: generate tag overview page(s)

* Local Variables                                                  :noexport:
# Local Variables:
# mode: auto-fill
# mode: flyspell
# eval: (ispell-change-dictionary "en_US")
# End:
